<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Lost & Found Portal</title>
    <style>
        body {
          font-family: "Segoe UI", sans-serif;
          background-color: #f5f7fa;
          margin: 0;
          padding: 0;
        }
        header {
          background-color: #0077b6;
          color: white;
          text-align: center;
          padding: 15px;
          font-size: 1.5rem;
          letter-spacing: 1px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        nav {
          text-align: center;
          background: white;
          padding: 10px;
          box-shadow: 0 1px 4px rgba(0,0,0,0.1);
        }
        nav a {
          text-decoration: none;
          color: #0077b6;
          margin: 0 10px;
          font-weight: 500;
        }
        h2 { color: #0077b6; text-align: center; margin-top: 25px; }
        table {
          width: 90%;
          margin: 15px auto;
          border-collapse: collapse;
          background: white;
          border-radius: 10px;
          overflow: hidden;
          box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        th, td {
          padding: 10px;
          border-bottom: 1px solid #eee;
          text-align: center;
          font-size: 0.95rem;
        }
        th {
          background: #0077b6;
          color: white;
        }
        tr:hover { background-color: #f1f1f1; }
        img { border-radius: 6px; object-fit: cover; }
        footer {
          text-align: center;
          padding: 15px;
          color: #555;
          font-size: 0.9rem;
        }
        button {
          background: #0077b6;
          border: none;
          color: white;
          padding: 6px 10px;
          border-radius: 5px;
          cursor: pointer;
        }
        button:hover {
          background: #005f87;
        }
    </style>
</head>
<body>
<header>Lost & Found Management Portal</header>

<nav>
    <a href="report-lost.html">Report Lost</a> |
    <a href="report-found.html">Report Found</a> |
    <a href="login.html" onclick="logout()">Logout</a>
</nav>

<h2>Lost Items</h2>
<table id="lostTable">
    <thead>
    <tr>
        <th>Image</th>
        <th>Item Name</th>
        <th>Description</th>
        <th>Location</th>
        <th>Contact Info</th>
        <th>Owner</th>
        <th>Status</th>
        <th>Action</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>

<h2>Found Items</h2>
<table id="foundTable">
    <thead>
    <tr>
        <th>Image</th>
        <th>Item Name</th>
        <th>Description</th>
        <th>Location</th>
        <th>Contact Info</th>
        <th>Finder</th>
        <th>Status</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>

<footer>© 2025 Lost & Found Portal | Developed with ❤️ in Java & Spring Boot</footer>

<script>
    const API = "http://localhost:8080/api/items";

    async function loadItems() {
      const res = await fetch(API);
      const data = await res.json();

      const lostItems = data.filter(i => i.status === "LOST");
      const foundItems = data.filter(i => i.status === "FOUND");

      renderLost(lostItems);
      renderFound(foundItems);
    }

    function renderLost(items) {
      const tbody = document.querySelector("#lostTable tbody");
      tbody.innerHTML = "";
      if (items.length === 0) {
        tbody.innerHTML = "<tr><td colspan='8'>No lost items reported.</td></tr>";
        return;
      }
      const userEmail = localStorage.getItem("email");

      items.forEach(item => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${item.imageUrl ? `<img src="${item.imageUrl}" width="60" height="60">` : ""}</td>
          <td>${item.itemName}</td>
          <td>${item.description}</td>
          <td>${item.location}</td>
          <td>${item.contactInfo}</td>
          <td>${item.ownerEmail || "-"}</td>
          <td>${item.claimed ? "Claimed" : item.claimRequested ? "Pending Approval" : "Unclaimed"}</td>
          <td>
            ${!item.claimed && item.ownerEmail === userEmail && !item.claimRequested
              ? `<button onclick="requestClaim(${item.id})">Request Claim</button>`
              : ""}
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function renderFound(items) {
      const tbody = document.querySelector("#foundTable tbody");
      tbody.innerHTML = "";
      if (items.length === 0) {
        tbody.innerHTML = "<tr><td colspan='7'>No found items reported.</td></tr>";
        return;
      }

      items.forEach(item => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${item.imageUrl ? `<img src="${item.imageUrl}" width="60" height="60">` : ""}</td>
          <td>${item.itemName}</td>
          <td>${item.description}</td>
          <td>${item.location}</td>
          <td>${item.contactInfo}</td>
          <td>${item.ownerEmail || "-"}</td>
          <td>
              ${
                item.claimed
                  ? "Claimed"
                  : item.claimRequested
                    ? "Claim Pending"
                    : (localStorage.getItem("email") === item.ownerEmail
                        ? "Available (You found this)"
                        : `<button onclick="requestClaim(${item.id})">Request Claim</button>`)
              }
            </td>
        `;
        tbody.appendChild(tr);
      });
    }

    async function requestClaim(id) {
      const email = localStorage.getItem("email");
      const res = await fetch(`${API}/${id}/request-claim`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email })
      });
      const data = await res.json();
      alert(data.message);
      loadItems();
    }

    function logout() {
      localStorage.clear();
    }

    loadItems();
</script>
</body>
</html>
